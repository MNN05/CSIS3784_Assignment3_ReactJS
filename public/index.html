<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laser Tag Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Audiowide&family=Press+Start+2P&family=VT323&display=swap');

        /* Global scrollbar styling for a consistent look */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0d1117; /* Dark background */
        }

        ::-webkit-scrollbar-thumb {
            background: #00FF00; /* Neon green */
            border-radius: 4px;
            box-shadow: 0 0 5px #00FF00;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #00FF00;
            box-shadow: 0 0 10px #00FF00;
        }

        /* CRT monitor effect with scanlines and curvature */
        .crt-monitor {
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,255,0,0.5), inset 0 0 20px rgba(0,255,0,0.3);
        }

        .crt-monitor::before, .crt-monitor::after {
            content: '';
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }

        .crt-monitor::before {
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 3px 100%;
            z-index: 2;
        }

        .crt-monitor::after {
            box-shadow: inset 0 0 100px #000;
            z-index: 3;
            pointer-events: none;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }

        .flicker-text {
            animation: flicker 0.5s infinite alternate;
        }

        @keyframes glitch {
            0% {
                transform: translate(0);
            }
            20% {
                transform: translate(-5px, 5px);
            }
            40% {
                transform: translate(-5px, -5px);
            }
            60% {
                transform: translate(5px, 5px);
            }
            80% {
                transform: translate(5px, -5px);
            }
            100% {
                transform: translate(0);
            }
        }

    </style>
</head>
<body class="bg-black text-white font-['VT323']">
    <div id="root"></div>

    <script type="text/babel">
    const { useState, useEffect } = React;

    // The main App component, which manages the different game states.
    const App = () => {
        // Use state to track the current game state: 'initial', 'start', 'join', 'player', or 'spectator'.
        const [gameState, setGameState] = useState('initial');

        // Function to handle state changes
        const handleStateChange = (newState) => {
            console.log(`Changing state from ${gameState} to ${newState}`);
            setGameState(newState);
        };

        // Component for the Initial Game Start UI
        const InitialScreen = ({ onScreenChange }) => (
            <div className="relative z-10 bg-black p-8 md:p-12 rounded-lg border-2 border-violet-500 w-full max-w-lg shadow-[0_0_40px_#db2777,0_0_80px_#9333ea] crt-monitor">
                <h1 className="text-4xl md:text-5xl text-center mb-8 tracking-widest text-violet-400 font-['Audiowide'] flicker-text" style={{ textShadow: '0 0 20px #8B5CF6, 0 0 40px #EC4899' }}>
                    LASER TAG
                </h1>
                <button
                    onClick={() => onScreenChange('start')}
                    className="w-full py-4 px-6 rounded-lg text-lg text-black font-bold tracking-widest uppercase transition-all duration-300
                    bg-gradient-to-r from-purple-500 to-pink-500 hover:from-pink-500 hover:to-purple-500
                    shadow-[0_0_20px_#A855F7] hover:shadow-[0_0_40px_#EC4899]
                    focus:outline-none focus:ring-4 focus:ring-violet-500 focus:ring-opacity-50"
                >
                     START GAME
                </button>
            </div>
        );

        // Component for the Start Screen UI
        const StartScreen = ({ onScreenChange }) => (
            <div className="relative z-10 bg-black p-8 md:p-12 rounded-lg border-2 border-fuchsia-500 w-full max-w-lg shadow-[0_0_40px_#d946ef,0_0_80px_#6366f1] crt-monitor">
                <h1 className="text-4xl md:text-5xl text-center mb-4 tracking-widest text-fuchsia-400 font-['Audiowide'] flicker-text" style={{ textShadow: '0 0 20px #C084FC, 0 0 40px #818CF8' }}>
                    LASER TAG
                </h1>
                <h2 className="text-xl md:text-2xl text-center mb-8 text-yellow-400 font-['Press Start 2P']" style={{ textShadow: '0 0 10px #FFFF00, 0 0 20px #FFFF00' }}>
                    READY?
                </h2>
                <div className="flex flex-col gap-4">
                    <button
                        onClick={() => onScreenChange('create')}
                        className="w-full py-4 px-6 rounded-lg text-lg text-black font-bold tracking-widest uppercase transition-all duration-300
                        bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-cyan-500 hover:to-blue-500
                        shadow-[0_0_20px_#3B82F6] hover:shadow-[0_0_40px_#22D3EE]
                        focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50"
                    >
                         CREATE GAME
                    </button>
                    <button
                        onClick={() => onScreenChange('join')}
                        className="w-full py-4 px-6 rounded-lg text-lg text-black font-bold tracking-widest uppercase transition-all duration-300
                        bg-gradient-to-r from-rose-500 to-pink-500 hover:from-pink-500 hover:to-rose-500
                        shadow-[0_0_20px_#E11D48] hover:shadow-[0_0_40px_#EC4899]
                        focus:outline-none focus:ring-4 focus:ring-rose-500 focus:ring-opacity-50"
                    >
                         JOIN GAME
                    </button>
                </div>
            </div>
        );

        // Component for the Create Game UI (placeholder for now)
        const CreateGameScreen = ({ onScreenChange }) => (
            <div className="relative z-10 bg-black p-8 md:p-12 rounded-lg border-2 border-cyan-500 w-full max-w-lg shadow-[0_0_40px_#06b6d4,0_0_80px_#0891b2] crt-monitor">
                <h1 className="text-4xl md:text-5xl text-center mb-4 tracking-widest text-cyan-400 font-['Audiowide'] flicker-text" style={{ textShadow: '0 0 20px #22D3EE, 0 0 40px #06B6D4' }}>
                    CREATE GAME
                </h1>
                <h2 className="text-xl md:text-2xl text-center mb-8 text-white font-['Press Start 2P']">
                    ...Awaiting Players...
                </h2>
                <button
                    onClick={() => onScreenChange('initial')}
                    className="w-full py-4 px-6 rounded-lg text-lg text-white font-bold tracking-widest uppercase transition-all duration-300 mt-4
                    bg-red-900 hover:bg-red-800
                    shadow-[0_0_20px_#FF0000] hover:shadow-[0_0_40px_#FF0000]
                    focus:outline-none focus:ring-4 focus:ring-red-500 focus:ring-opacity-50"
                >
                     CANCEL
                </button>
            </div>
        );

        // Component for the Join Game UI
        const JoinScreen = ({ onScreenChange }) => (
            <div className="relative z-10 bg-black p-8 md:p-12 rounded-lg border-2 border-orange-500 w-full max-w-lg shadow-[0_0_40px_#f97316,0_0_80px_#f59e0b] crt-monitor">
                <h1 className="text-4xl md:text-5xl text-center mb-4 tracking-widest text-orange-400 font-['Audiowide'] flicker-text" style={{ textShadow: '0 0 20px #FBBF24, 0 0 40px #F97316' }}>
                    JOIN GAME
                </h1>
                <h2 className="text-xl md:text-2xl text-center mb-8 text-white font-['Press Start 2P']">
                    ENTER DATA:
                </h2>
                <div className="flex flex-col gap-4 mb-8">
                    <input
                        type="text"
                        placeholder="PLAYER NAME"
                        className="w-full px-4 py-3 rounded-lg text-lg bg-black text-lime-400 placeholder-lime-700 border border-lime-500 focus:outline-none focus:ring-2 focus:ring-lime-400 transition-colors duration-300 shadow-inner shadow-lime-900"
                    />
                    <input
                        type="text"
                        placeholder="GAME CODE"
                        className="w-full px-4 py-3 rounded-lg text-lg bg-black text-lime-400 placeholder-lime-700 border border-lime-500 focus:outline-none focus:ring-2 focus:ring-lime-400 transition-colors duration-300 shadow-inner shadow-lime-900"
                    />
                </div>
                <div className="flex flex-col gap-4">
                    {/* The 'Join as Player' button now takes the user to the waiting lobby */}
                    <button
                        onClick={() => onScreenChange('waitingLobby')}
                        className="w-full py-4 px-6 rounded-lg text-lg text-black font-bold tracking-widest uppercase transition-all duration-300
                        bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-cyan-500 hover:to-blue-500
                        shadow-[0_0_20px_#3B82F6] hover:shadow-[0_0_40px_#22D3EE]
                        focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50"
                    >
                         JOIN AS PLAYER
                    </button>
                    <button
                        onClick={() => onScreenChange('spectator')}
                        className="w-full py-4 px-6 rounded-lg text-lg text-black font-bold tracking-widest uppercase transition-all duration-300
                        bg-gradient-to-r from-rose-500 to-pink-500 hover:from-pink-500 hover:to-rose-500
                        shadow-[0_0_20px_#E11D48] hover:shadow-[0_0_40px_#EC4899]
                        focus:outline-none focus:ring-4 focus:ring-rose-500 focus:ring-opacity-50"
                    >
                         JOIN AS SPECTATOR
                    </button>
                    <button
                        onClick={() => onScreenChange('initial')}
                        className="w-full py-2 px-6 rounded-lg text-sm text-gray-400 font-bold tracking-widest uppercase transition-all duration-300 mt-4
                        hover:text-red-400 focus:outline-none"
                    >
                         BACK
                    </button>
                </div>
            </div>
        );

        // --- NEW WAITING LOBBY COMPONENT ---
        const WaitingLobbyScreen = ({ onScreenChange }) => {
            // Hardcoded player list for now
            const playersInLobby = ["RETRO", "NEON-FOX", "PIXEL-PUNK", "SPECTRE"];

            return (
                <div className="relative z-10 bg-black p-8 md:p-12 rounded-lg border-2 border-emerald-500 w-full max-w-lg shadow-[0_0_40px_#34d399,0_0_80px_#10b981] crt-monitor">
                    <h1 className="text-4xl md:text-5xl text-center mb-4 tracking-widest text-emerald-400 font-['Audiowide'] flicker-text" style={{ textShadow: '0 0 20px #10B981, 0 0 40px #34D399' }}>
                        WAITING LOBBY
                    </h1>
                    <h2 className="text-xl md:text-2xl text-center mb-8 text-white font-['Press Start 2P']">
                        PLAYERS:
                    </h2>
                    <ul className="list-none mb-8 space-y-3">
                        {playersInLobby.map((player, index) => (
                            <li key={index} className="bg-gray-900 p-4 rounded-lg border-2 border-emerald-400 shadow-[0_0_15px_#10B981]">
                                <p className="text-lg text-emerald-300">{player}</p>
                            </li>
                        ))}
                    </ul>
                    <button
                        onClick={() => onScreenChange('player')}
                        className="w-full py-4 px-6 rounded-lg text-lg text-black font-bold tracking-widest uppercase transition-all duration-300
                        bg-gradient-to-r from-purple-500 to-pink-500 hover:from-pink-500 hover:to-purple-500
                        shadow-[0_0_20px_#A855F7] hover:shadow-[0_0_40px_#EC4899]
                        focus:outline-none focus:ring-4 focus:ring-violet-500 focus:ring-opacity-50"
                    >
                         START GAME
                    </button>
                    <button
                        onClick={() => onScreenChange('initial')}
                        className="w-full py-2 px-6 rounded-lg text-sm text-gray-400 font-bold tracking-widest uppercase transition-all duration-300 mt-4
                        hover:text-red-400 focus:outline-none"
                    >
                         CANCEL
                    </button>
                </div>
            );
        };

        // Component for the Player Game UI
        const PlayerScreen = ({ onScreenChange }) => {
            const username = "RetroGamer";
            const gameCode = "A1B2C3D4";
            const score = 1200;
            const timer = "05:45";
            const health = 75; // Example health value for the progress bar

            return (
                <div className="relative z-10 bg-black p-4 md:p-8 rounded-lg border-2 border-lime-500 w-full max-w-4xl shadow-[0_0_40px_#84cc16,0_0_80px_#65a30d] crt-monitor">
                    <div className="flex justify-between items-center mb-4 md:mb-6">
                        <div className="bg-gray-900 rounded-lg p-2 md:p-3 border border-pink-400 shadow-[0_0_20px_#EC4899]">
                            <h2 className="text-sm md:text-base text-pink-400 font-['Press Start 2P']">
                                USER: <span className="text-white">{username}</span>
                            </h2>
                            </div>
                        <div className="bg-gray-900 rounded-lg p-2 md:p-3 border border-pink-400 shadow-[0_0_20px_#EC4899]">
                            <h2 className="text-sm md:text-base text-pink-400 font-['Press Start 2P']">
                                CODE: <span className="text-white">{gameCode}</span>
                            </h2>
                        </div>
                    </div>

                    {/* Player's View / Video Feed Placeholder */}
                    <div className="relative w-full h-64 md:h-96 bg-gray-900 border-4 border-yellow-400 rounded-lg overflow-hidden mb-6 shadow-inner shadow-yellow-900">
                        <div className="absolute inset-0 flex items-center justify-center">
                            <p className="text-yellow-400 font-['Press Start 2P'] text-xl md:text-2xl animate-pulse">VIDEO FEED</p>
                        </div>
                    </div>

                    <div className="flex justify-between items-center mb-6">
                        {/* Score Display */}
                        <div className="flex flex-col items-center bg-gray-900 rounded-lg p-3 md:p-4 border border-fuchsia-400 shadow-[0_0_20px_#c026d3]">
                            <p className="text-sm md:text-base text-gray-400 font-['Press Start 2P']">SCORE</p>
                            <p className="text-3xl md:text-4xl text-fuchsia-400 font-['Audiowide']" style={{ textShadow: '0 0 20px #C084FC' }}>{score}</p>
                        </div>
                        {/* Timer Display */}
                        <div className="flex flex-col items-center bg-gray-900 rounded-lg p-3 md:p-4 border border-lime-400 shadow-[0_0_20px_#84cc16]">
                            <p className="text-sm md:text-base text-gray-400 font-['Press Start 2P']">TIME</p>
                            <p className="text-3xl md:text-4xl text-lime-400 font-['Audiowide']" style={{ textShadow: '0 0 20px #84cc16' }}>{timer}</p>
                        </div>
                    </div>

                    {/* Progress Bar (Health/Energy) */}
                    <div className="w-full h-8 bg-gray-700 rounded-full mb-6 relative shadow-inner shadow-gray-900">
                        <div
                            className="h-full rounded-full transition-all duration-500"
                            style={{ width: `${health}%`, backgroundImage: 'linear-gradient(to right, #e11d48, #db2777, #9333ea, #6366f1)', boxShadow: '0 0 20px #a855f7, 0 0 40px #EC4899' }}>
                        </div>
                        <p className="absolute inset-0 flex items-center justify-center text-sm md:text-base font-bold text-white font-['Press Start 2P']">
                            HEALTH: {health}%
                        </p>
                    </div>

                    {/* Action Buttons */}
                    <div className="flex flex-col md:flex-row gap-4">
                        <button
                            className="flex-1 py-4 px-6 rounded-lg text-lg text-black font-bold tracking-widest uppercase transition-all duration-300
                            bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-cyan-500 hover:to-blue-500
                            shadow-[0_0_20px_#3B82F6] hover:shadow-[0_0_40px_#22D3EE]
                            focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50"
                        >
                             FIRE
                        </button>
                        <button
                            onClick={() => onScreenChange('initial')}
                            className="flex-1 py-4 px-6 rounded-lg text-lg text-white font-bold tracking-widest uppercase transition-all duration-300
                            bg-red-900 hover:bg-red-800
                            shadow-[0_0_20px_#FF0000] hover:shadow-[0_0_40px_#FF0000]
                            focus:outline-none focus:ring-4 focus:ring-red-500 focus:ring-opacity-50"
                        >
                             QUIT
                        </button>
                    </div>
                </div>
            );
        };

        // Component for the Spectator Game UI
        const SpectatorScreen = ({ onScreenChange }) => {
            const gameCode = "A1B2C3D4";
            const timer = "05:45";
            const players = [
                { name: "RETRO", score: 1200, health: 75, status: "Active" },
                { name: "NEON-FOX", score: 980, health: 90, status: "Active" },
                { name: "PIXEL-PUNK", score: 750, health: 30, status: "Active" },
                { name: "SYNTHWAVE", score: 500, health: 100, status: "Active" },
            ];

            return (
                <div className="relative z-10 bg-black p-4 md:p-8 rounded-lg border-2 border-violet-500 w-full max-w-6xl shadow-[0_0_40px_#9333ea,0_0_80px_#db2777] crt-monitor">
                    <div className="flex flex-col md:flex-row justify-between items-center mb-4 md:mb-6">
                        <h1 className="text-2xl md:text-3xl text-center tracking-widest text-violet-400 font-['Audiowide'] mb-2 md:mb-0" style={{ textShadow: '0 0 20px #8B5CF6, 0 0 40px #A855F7' }}>
                            SPECTATOR VIEW
                        </h1>
                        <div className="flex gap-4">
                            <div className="bg-gray-900 rounded-lg p-2 md:p-3 border border-pink-400 shadow-[0_0_20px_#EC4899]">
                                <h2 className="text-sm md:text-base text-pink-400">
                                    CODE: <span className="text-white">{gameCode}</span>
                                </h2>
                            </div>
                            <div className="bg-gray-900 rounded-lg p-2 md:p-3 border border-pink-400 shadow-[0_0_20px_#EC4899]">
                                <h2 className="text-sm md:text-base text-pink-400">
                                    TIME: <span className="text-white">{timer}</span>
                                </h2>
                            </div>
                        </div>
                    </div>

                    {/* Leaderboard Section */}
                    <div className="mb-8">
                        <h3 className="text-xl md:text-2xl text-cyan-400 font-['Press Start 2P'] mb-4">LEADERBOARD</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            {players.map((player, index) => (
                                <div key={index} className="bg-gray-900 p-4 rounded-lg flex justify-between items-center shadow-[0_0_20px_#00FFFF] border-2 border-cyan-400">
                                    <div>
                                        <p className="text-lg text-white">{player.name}</p>
                                        <p className="text-sm text-gray-400">SCORE: {player.score}</p>
                                    </div>
                                    <div className="h-6 w-16 rounded-full bg-gray-700 relative overflow-hidden">
                                        <div className="h-full rounded-full" style={{ width: `${player.health}%`, backgroundImage: 'linear-gradient(to right, #FF00FF, #00FFFF)' }}></div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Player Views Grid Section */}
                    <div>
                        <h3 className="text-xl md:text-2xl text-fuchsia-400 font-['Press Start 2P'] mb-4">LIVE FEEDS</h3>
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-6">
                            {players.map((player, index) => (
                                <div key={index} className="relative w-full h-48 bg-gray-900 border-4 border-fuchsia-400 rounded-lg overflow-hidden flex items-center justify-center shadow-[0_0_20px_#FF00FF]">
                                    <p className="text-fuchsia-400 font-['Press Start 2P'] text-lg animate-pulse">
                                        {player.name}
                                    </p>
                                </div>
                            ))}
                        </div>
                    </div>

                    <button
                        onClick={() => onScreenChange('initial')}
                        className="w-full py-4 px-6 rounded-lg text-lg text-white font-bold tracking-widest uppercase transition-all duration-300 mt-8
                        bg-red-900 hover:bg-red-800
                        shadow-[0_0_20px_#FF0000] hover:shadow-[0_0_40px_#FF0000]
                        focus:outline-none focus:ring-4 focus:ring-red-500 focus:ring-opacity-50"
                    >
                         QUIT
                    </button>
                </div>
            );
        };

        let screenComponent;
        switch (gameState) {
            case 'initial':
                screenComponent = <InitialScreen onScreenChange={handleStateChange} />;
                break;
            case 'start':
                screenComponent = <StartScreen onScreenChange={handleStateChange} />;
                break;
            case 'create':
                screenComponent = <CreateGameScreen onScreenChange={handleStateChange} />;
                break;
            case 'join':
                screenComponent = <JoinScreen onScreenChange={handleStateChange} />;
                break;
            case 'waitingLobby':
                screenComponent = <WaitingLobbyScreen onScreenChange={handleStateChange} />;
                break;
            case 'player':
                screenComponent = <PlayerScreen onScreenChange={handleStateChange} />;
                break;
            case 'spectator':
                screenComponent = <SpectatorScreen onScreenChange={handleStateChange} />;
                break;
            default:
                screenComponent = null;
        }

        return (
            <div className="min-h-screen relative flex flex-col items-center justify-center p-4 overflow-hidden bg-black">
                {/* Retro-futuristic background grid effect */}
                <div className="absolute inset-0 z-0 opacity-50">
                    <div className="absolute inset-0 bg-repeat bg-center" style={{ backgroundImage: "url('data:image/svg+xml,%3Csvg width=\"80\" height=\"80\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cpath d=\"M0 0h100v100H0z\" fill=\"none\"/%3E%3Ccircle cx=\"50\" cy=\"50\" r=\"2\" fill=\"%238B5CF6\"/%3E%3Ccircle cx=\"25\" cy=\"75\" r=\"2\" fill=\"%23EC4899\"/%3E%3Ccircle cx=\"75\" cy=\"25\" r=\"2\" fill=\"%2322D3EE\"/%3E%3C/svg%3E')", backgroundSize: '40px 40px' }}></div>
                    <div className="absolute inset-0" style={{ backgroundImage: 'radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.8) 70%)'}}></div>
                </div>

                <div className="absolute top-4 left-4 z-10 text-xs text-lime-400 font-bold">
                    CURRENT STATE: {gameState.toUpperCase()}
                </div>

                {screenComponent}
            </div>
        );
    };

    // The script now waits for the entire window to load before starting the React app.
    window.onload = function() {
        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(React.createElement(App));
    };
    </script>
    <script type="module" src="/js/client.js"></script>
</body>
</html>